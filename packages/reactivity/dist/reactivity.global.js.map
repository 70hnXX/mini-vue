{
  "version": 3,
  "sources": ["../src/index.ts", "../../shared/src/index.ts", "../src/effect.ts", "../src/baseHandler.ts", "../src/reactive.ts"],
  "sourcesContent": ["export { reactive } from \"./reactive\";\nexport {effect} from './effect'", "export const isObject = (value) => {\n  return typeof value === 'object' && value !== null;\n}", "export let activeEffect = undefined  \n\nexport function effect (fn,options:any={}) {\n  const _effect = new ReactiveEffect(fn,options.scheduler); // \u521B\u5EFA\u4E00\u4E2A\u54CD\u5E94\u5F0Feffect\n  _effect.run(); // \u9ED8\u8BA4\u6267\u884C\u4E00\u6B21\n\n  const runner = _effect.run.bind(_effect)\n  runner.effect = _effect\n  return runner\n}\n\nclass ReactiveEffect {\n  public parent = null\n  public active = true; // \u8FD9\u4E2Aeffect\u9ED8\u8BA4\u662F\u6FC0\u6D3B\u72B6\u6001\n  public deps = []; // \u88AB\u54EA\u4E9B\u5C5E\u6027\u88AB\u4F9D\u8D56\n  constructor(public fn,public scheduler) {}; // \u7528\u6237\u4F20\u9012\u7684\u53C2\u6570\u4E5F\u4F1A\u5230this\u4E0A,\u5373this.fn = fn\n\n  run() { // \u6267\u884Ceffect\n    if(!this.active) {this.fn()} // \u5982\u679C\u4E0D\u662F\u6FC0\u6D3B\u72B6\u6001,\u5C31\u53EA\u6267\u884C\u4E00\u6B21\u51FD\u6570,\u4E0D\u8FDB\u884C\u4F9D\u8D56\u6536\u96C6\n    // \u8FDB\u884C\u4F9D\u8D56\u6536\u96C6\n    try {\n      // \u8BB0\u5F55parent\n      this.parent = activeEffect\n      activeEffect = this\n      // \u6267\u884C\u6536\u96C6\u4E4B\u524D,\u5220\u9664\u6389\u4EE5\u524D\u6536\u96C6\u7684\u5185\u5BB9\n      clearnupEffect(this)\n      return this.fn(); // \u5F53\u7A0D\u540E\u8C03\u7528\u53D6\u503C\u64CD\u4F5C\u65F6,\u5C31\u80FD\u83B7\u53D6\u5230\u8FD9\u4E2A\u5168\u5C40\u7684activeEffect\n    } finally {\n      activeEffect = this.parent\n    }\n  }\n  stop() {\n    if(this.active) {\n      this.active = false;\n      clearnupEffect(this)\n    }\n  }\n}\n\nfunction clearnupEffect(effect) {\n  const {deps} =effect // deps\u91CC\u9762\u88C5\u7684\u662F\u5C5E\u6027\u5BF9\u5E94\u7684effect\n  for (let i = 0; i < deps.length; i++) {\n    deps[i].delete(effect) // \u89E3\u9664\u5C5E\u6027\u6536\u96C6\u7684effect\n  }\n  effect.deps.length = 0\n}\n\nconst targetMap = new WeakMap();\n\n// \u4F9D\u8D56\u6536\u96C6:\n// \u4E00\u4E2A\u5BF9\u8C61 -> \u67D0\u4E2A\u5C5E\u6027 -> \u591A\u4E2Aeffect\n// WeakMap = {\u5BF9\u8C61:Map{name:Set}} \u7528set\u6765\u5B58\u50A8effect\nexport function track(target,type,key) {\n  if(!activeEffect) return; // \u4E0D\u5728effect\u4E2D\u5C31\u4EC0\u4E48\u4E5F\u4E0D\u505A\n  let depsMap = targetMap.get(target); // \u5BFB\u627E\u5F53\u524Dtarget\u662F\u5426\u5DF2\u7ECF\u8BB0\u5F55\n  if(!depsMap) { // \u672A\u8BB0\u5F55\u5C31\u53BB\u8BB0\u5F55\n    targetMap.set(target,(depsMap = new Map()))\n  }\n  let dep = depsMap.get(key); // \u5BFB\u627E\u5F53\u524D\u8BB0\u5F55\u7684target\u4E2D\u662F\u5426\u8BB0\u5F55\u8FC7\u8FD9\u4E2Akey\n  if(!dep) { // \u6CA1\u6709\u8BB0\u5F55\u8FD9\u4E2A\u5C5E\u6027\u5C31\u53BB\u8BB0\u5F55\u8FD9\u4E2A\u5C5E\u6027\n    depsMap.set(key,(dep = new Set()))\n  }\n  let shouldTrack = !dep.has(activeEffect) // \u5224\u65AD\u5F53\u524Dset\u91CC\u9762\u6709\u6CA1\u6709\u5F53\u524D\u7684effect\n  if(shouldTrack) {\n    dep.add(activeEffect) // \u4EE3\u7406\u5BF9\u8C61\u8BB0\u5F55effect\n    activeEffect.deps.push(dep) // effect\u8BB0\u5F55\u5F53\u524Dset,\u5F31\u5F15\u7528,\u7B49\u4F1A\u6E05\u7406\u7684\u65F6\u5019\u76F4\u63A5\u4FEE\u6539\u8FD9\u4E2Aset,\u8FD9\u6837target\u4E0A\u9762\u5C31\u4E0D\u4F1A\u627E\u5230\u4E86\n  }\n}\n\n// \u6D3E\u53D1\u66F4\u65B0\nexport function trigger(target,type,key,value,oldVal) {\n  // 1.\u627Etarget\n  const depsMap = targetMap.get(target)\n  if(!depsMap) return; // \u89E6\u53D1\u7684\u503C\u6CA1\u6709\u5728\u6A21\u677F\u4E2D\u4F7F\u7528\n  // 2.\u627Ekey\u7684set\n  let effects = depsMap.get(key);\n  if(effects) {\n    // \u8FD9\u91CC\u8FD9\u4E48\u505A\u7684\u539F\u56E0\u662F\u907F\u514D\u540E\u9762\u505A\u5206\u652F\u5207\u6362\u7684\u65F6\u5019\u6E05\u7A7A\u4F9D\u8D56\u5F15\u8D77\u7684\u7206\u6808,\u56E0\u4E3A\u90A3\u4E2A\u65F6\u5019\u4F1A\u5C06set\u6E05\u7A7A\u518D\u6DFB\u52A0,\u5BFC\u81F4\u4E00\u76F4\u89E6\u53D1\n    effects = new Set(effects)\n    effects.forEach(effect => {\n      if(effect !== activeEffect) { // \u907F\u514D\u5FAA\u73AF\u8C03\u7528\u7206\u6808\n        if(effect.scheduler) {\n          effect.scheduler()\n        } else{\n          effect.run()\n        }\n      };\n    })\n  }\n}", "import { track, trigger } from \"./effect\";\n\nexport const enum ReactiveFlags {\n  IS_REACTIVE = \"__v_isReactive\",\n}\n\nexport const mutableHandlers = {\n  get(target, key, reciver) {\n    if (key === ReactiveFlags.IS_REACTIVE) {\n      return true;\n    }\n    // effect\u4F9D\u8D56\u6536\u96C6\n    track(target,'get',key)\n    return Reflect.get(target, key, reciver);\n  },\n  set(target, key, value, reciver) {\n    // \u4FEE\u6539\u503C,\u53BB\u6D3E\u53D1effect\u7684\u66F4\u65B0\n    let oldVal = target[key];\n    let result = Reflect.set(target, key, value, reciver) // \u4F1A\u8FD4\u56DE\u662F\u5426\u6210\u529F\n    if(oldVal !== value) {\n      // \u5F53\u524D\u503C\u53D8\u5316\u4E86\n      trigger(target,'set',key,value,oldVal);\n    }\n    return result;\n  },\n};\n", "import { isObject } from \"@vue/shared\";\nimport { mutableHandlers, ReactiveFlags } from \"./baseHandler\";\n\nconst reactiveMap = new WeakMap(); //\n\nexport const reactive = (target) => {\n  // \u5224\u65AD\u662F\u5426\u4E3A\u5BF9\u8C61\uFF0C\u4E0D\u662F\u5BF9\u8C61\u5C31\u4E0D\u505A\u4EE3\u7406\n  if (!isObject(target)) return;\n  // \u5224\u65AD\u662F\u5426\u4EE3\u7406\u8FC7,\u672A\u88AB\u4EE3\u7406\u8FC7\u7684\u5BF9\u8C61,\u4F1A\u53D6'__v_isReactive'\u5C5E\u6027\uFF0C\u6CA1\u6709\u8FD9\u4E2A\u5C5E\u6027\uFF0C\u8FD4\u56DEfalse\n  // \u4EE3\u7406\u8FC7\u7684\u5BF9\u8C61\uFF0C\u662F\u4E00\u4E2Aproxy\uFF0C\u5C31\u4F1A\u53BB\u8C03\u7528get\uFF0C\u7136\u540Ekey === '__v_isReactive', \u8FD4\u56DEtrue\n  if (target[ReactiveFlags.IS_REACTIVE]) {\n    return target;\n  }\n  // \u67E5\u627E\u7F13\u5B58,\u4EE3\u7406\u8FC7\u7684\u5BF9\u8C61\uFF0C\u76F4\u63A5\u8FD4\u56DEproxy\n  let existingProxy = reactiveMap.get(target);\n  if (existingProxy) return existingProxy;\n  // \u8BBE\u7F6E\u4EE3\u7406\n  const proxy = new Proxy(target, mutableHandlers);\n\n  // \u7F13\u5B58\u4EE3\u7406,\u518D\u6B21\u4EE3\u7406\u65F6\u8FD4\u56DE\u4E0A\u4E00\u6B21\u7684\u4EE3\u7406\n  reactiveMap.set(target, proxy);\n\n  return proxy;\n};\n"],
  "mappings": "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",
  "names": ["effect"]
}
